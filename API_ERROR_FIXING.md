# üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**

## üö® **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
```
User not found at Object.createChat (src/lib/chat-api.ts:17:13)
```

## üîç **–ü—Ä–∏—á–∏–Ω–∞:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Clerk, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

## ‚úÖ **–†–µ—à–µ–Ω–∏—è:**

### **1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Ä—É—á–Ω—É—é:**

#### **–®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å Clerk ID**
```bash
# –í –±—Ä–∞—É–∑–µ—Ä–µ (F12 ‚Üí Console):
window.Clerk.user.id
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π ID, –Ω–∞–ø—Ä–∏–º–µ—Ä: user_2your_clerk_id_here
```

#### **–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export CLERK_USER_ID=user_2your_clerk_id_here

# –ò–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
node scripts/create-user.mjs user_2your_clerk_id_here
```

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

#### **Webhook –¥–ª—è Clerk:**
```typescript
// src/app/api/webhooks/clerk/route.ts
export async function POST(request: NextRequest) {
  const payload = await request.json()
  const { type, data } = payload

  if (type === 'user.created') {
    // –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
    await prisma.user.create({
      data: {
        clerkId: data.id,
        email: data.email_addresses[0]?.email_address,
        role: 'user'
      }
    })
  }

  return NextResponse.json({ success: true })
}
```

### **3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

#### **–í API routes:**
```typescript
import { handleAPIError } from '@/lib/api-error-handler'

try {
  // –õ–æ–≥–∏–∫–∞ API
} catch (error) {
  const apiError = handleAPIError(error)
  return NextResponse.json(apiError, { status: apiError.status })
}
```

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

#### **–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DATABASE_URL
echo $DATABASE_URL

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
npx prisma db ping
```

#### **–ï—Å–ª–∏ –±–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker-compose down
docker-compose up -d postgres

# –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É
npx prisma db push --force-reset
```

## üõ†Ô∏è **–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```bash
node scripts/create-user.mjs
```

### **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```bash
node scripts/sync-users.mjs
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```bash
node scripts/check-db.mjs
```

## üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

### **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å npm run dev
# –°–º–æ—Ç—Ä–µ—Ç—å –∑–∞ –æ—à–∏–±–∫–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ
npx prisma studio

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ SQL:
psql $DATABASE_URL
SELECT * FROM users WHERE clerk_id = 'your_clerk_id';
```

### **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API routes:**
```bash
# –¢–µ—Å—Ç health endpoint
curl http://localhost:3000/api/radon/health

# –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:3000/api/chats
```

## üöÄ **–ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

1. **–ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à Clerk ID** –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ:** `node scripts/create-user.mjs YOUR_CLERK_ID`
3. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

## üìã **–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

- ‚úÖ **–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (`scripts/create-user.mjs`)
- ‚úÖ **–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø–æ–ª—É—á–µ–Ω–∏—è Clerk ID** (`scripts/get-clerk-id.mjs`)
- ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –≤ API routes
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ API routes** —Å –ª—É—á—à–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏!** üîß
